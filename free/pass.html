<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- saved from url=(0327)https://wk.tiangong.edu.cn/app_xgc/work/tjpu/yqfkxscx/yqfkxscrx.jsp?iportal.uid=79107&iportal.uxid=1810910323&iportal.uname=%E9%82%A2%E8%BE%B0%E5%BF%97&iportal.timestamp=1616592359068&iportal.nonce=3811&iportal.group=%E6%9C%AC%E7%A7%91%E7%94%9F&iportal.signature=fa2347af9c384a2eadb924343d3add444f2b7661&iportal.ip=169.254.64.5 -->
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>学生进出通行证</title>


	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<!-- Tell the browser to be responsive to screen width -->
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<!-- æµè§å¨å¾æ  -->
	<link rel="shortcut icon" href="https://wk.tiangong.edu.cn/app_xgc/favicon.ico" type="image/x-icon">
	<!-- Bootstrap 3.3.5 -->
	<link rel="stylesheet" href="./include/bootstrap.min.css">
	<!-- Font Awesome -->
	<link rel="stylesheet" type="text/css" href="./include/font-awesome.min.css">
	<!-- Ionicons -->
	<link rel="stylesheet" href="./include/ionicons.min.css">
	<!-- DataTables -->
	<link rel="stylesheet" href="./include/dataTables.bootstrap.css">
	<!-- daterange picker -->
	<link rel="stylesheet" href="./include/daterangepicker.css">
	<link rel="stylesheet" href="./include/datepicker3.css">
	<!-- Bootstrap time Picker -->
	<link rel="stylesheet" href="./include/bootstrap-timepicker.min.css">
	<!-- Select2 -->
	<link rel="stylesheet" href="./include/select2.min.css">
	<!-- iCheck for checkboxes and radio inputs -->
	<link rel="stylesheet" href="./include/all.css">
	<!-- Theme style -->

	<!-- SDM Skins. We have chosen the skin-blue for this starter
          page. However, you can choose any other skin. Make sure you
          apply the skin class to the body tag so the changes take effect.
    -->
	<link rel="stylesheet" href="./include/skin-blue.min.css">
	<link rel="stylesheet" type="text/css" href="./include/uploadify.css">
	<link rel="stylesheet" href="./include/sdm.css">
	<!-- å¼æ¾æä»¶ åè®¸ä¿®æ¹æ§ä»¶çé¢è² -->
	<link rel="stylesheet" href="./include/style.css">
	<link rel="stylesheet" href="./include/layout-2.css">
	<link rel="stylesheet" href="./include/mspplus_form.css">
	<link rel="stylesheet" href="./include/coreplus-form.css">
	<!-- ææºç«¯ éææ ·å¼è¡¨ -->
	<!--<link rel="stylesheet"-->
	<!--href="/app_xgc/base/_libs/coreplus/coreplus-form-mobile.css">-->
	<link rel="stylesheet" href="./include/wangEditor.min.css">
	<link rel="stylesheet" href="./include/coreplus-form-normal.css">


	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
        <script src="/app_xgc/base/_libs/plugins/html5shiv/html5shiv.js"></script>
        <script src="/app_xgc/base/_libs/plugins/respond/respond.js"></script>
        <script src="/app_xgc/base/_libs/plugins/jQuery/jQuery-1.12.4.js"></script>
    <![endif]-->
	<!--[if lt IE 7]>
        <script language="javascript" type="text/javascript">
			setTimeout(function(){
				window.location.href='/app_xgc/base/_libs/dist/browsers.html?refer='+encodeURIComponent(location.href);
			},500)
		</script>
    <![endif]-->
	<script>
		var __basePath = "/app_xgc/base/";
		var __contextPath = "/app_xgc";
		var extendconfig = {};
		var domain = "tiangong.edu.cn";
		if (window.location.href.indexOf(domain) >= 0) {
			document.domain = domain;
		}
		function browserType(isPad) {
			var sUserAgent = navigator.userAgent.toLowerCase();
			var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
			var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
			var bIsMidp = sUserAgent.match(/midp/i) == "midp";
			var bIsUc7 = sUserAgent.match(/rv:1.2.3.4/i) == "rv:1.2.3.4";
			var bIsUc = sUserAgent.match(/ucweb/i) == "ucweb";
			var bIsAndroid = sUserAgent.match(/android/i) == "android";
			var bIsCE = sUserAgent.match(/windows ce/i) == "windows ce";
			var bIsWM = sUserAgent.match(/windows mobile/i) == "windows mobile";
			if (!isPad) {
				if (bIsIpad || bIsIphoneOs || bIsMidp || bIsUc7 || bIsUc || bIsAndroid || bIsCE || bIsWM) {
					return "phone";
				} else {
					return "pc";
				}
			} else {
				return bIsIpad;
			}
		}
		if (browserType() === "phone") {
			var head = document.getElementsByTagName('head')[0];
			var link = document.createElement('link');
			link.rel = 'stylesheet';
			link.href = "/app_xgc/base/_libs/coreplus/coreplus-form-mobile-old.css";
			head.appendChild(link);
		}

	</script>


	<link rel="stylesheet" type="text/css" href="./include/app.css">
	<link rel="stylesheet" type="text/css" href="./include/style(1).css">
	<style type="text/css">
		.wrapper.green:after {
			background: #4daa40;
		}

		.body.green.statues {
			background: #4daa40;
		}

		.wrapper.blue:after {
			background: #0459aa;
		}

		.body.blue.statues {
			background: #0459aa;
		}

		.wrapper.red:after {
			background: #e03636;
		}
	</style>
	<link rel="stylesheet" href="./include/layer.css" id="layui_layer_skinlayercss" style="">
	<link rel="stylesheet" type="text/css" href="./include/suiext.css">
</head>

<body>
	<div class="wrapper red">
		<div class="body">
			<div class="logo"><img src="./include/logo.png"></div>
			<div class="content">
				<div class="con">
					<div class="pic"><img id="zpimg" src="./include/photo.jpg"
						style="width: 200px; height: 200px; border-radius: 25px;"></div>
					<div class="display-stu-info" style="display:none;">						
						<div class="title name">姓名：<span name="xm"></span></div>
						<div class="title xy">学院：<span name="xy"></span></div>
						<div class="title xh">学号：<span name="gh"></span></div>
						<div class="title starttime" format="YYYY-MM-DD HH:mm">出发时间：<span name="qjkssj"></span></div>
						<div class="title endtime" format="YYYY-MM-DD HH:mm">返回时间：<span name="qjjssj"></span></div>							
						<div class="title sk">现在时刻：<span name="sj" style="color:red"></span></div>
						<div class="statues" id="cx_btn" style="background: rgb(77, 170, 64);">我要出校</div>
						<div class="statues" id="jx_btn" style="display: none; background: rgb(77, 170, 64);">我要回校</div>
						<div class="und" id="jzlogo" style="display: none;"><img src="./include/und.png"></div>
						<div class="undtitle" style="display: none;">暂无出校权限</div>
						<div class="undtext" style="display: none;">
							<p><span class="num">1.</span><span class="text">请您去学生外出报备申请中进行出校申请。</span></p>
							<p><span class="num">2.</span><span class="text">使用过程中如出现误点请联系辅导员进行沟通。</span></p>
						</div>
					</div>
					<div id="upload-info-div">
						<input id="picture-input" type="file" accept="image/*" style="display:block; margin-left:auto; margin-right:auto;" buttontext="选择图片"/>		
						<form class="upload-student-info">
							<div class="title name">姓名：<input id="in-stuname" name="stuinfo" style="border:none" /></div>
							<div class="title xy">学院：<input id="in-department" name="stuinfo" style="border:none" /></div>
							<div class="title xh">学号：<input id="in-stuid" name="stuinfo" style="border:none" /></div>
							<div class="title starttime" format="YYYY-MM-DD HH:mm">出发时间：<input id="in-starttime" name="stuinfo" type="datetime-local" style="border:none" /></div>
							<div class="title endtime" format="YYYY-MM-DD HH:mm">返回时间：<input id="in-endtime" name="stuinfo" type="datetime-local" style="border:none" /></div>
							<input class="statues" type="button" style="display:block; margin-left:auto; margin-right:auto; background: #e03636;" value="提交" onclick="uploadStuInfo();">
							<!-- <div class="statues" id="upload_btn" style="background: rgb(77, 170, 64);">提交</div> -->
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="./include/jQuery-2.1.4.min.js.下载"></script>
	<script src="./include/layer.js.下载"></script>
	<script src="./include/suiext.js.下载"></script>
	<footer class="app-footer app-mini-footer" style="display: none;"
		data-load="/app_xgc/base/_public/include/mini_footer.html">
		<div id="footer" class="footer-wrapper">
			<div class="app-footer-inner">
				<div class="app-copyright">
					<p>仅供学习参考使用</p>
				</div>
			</div>
		</div>
	</footer>

	<!-- REQUIRED JS SCRIPTS -->
	<!-- jQuery 2.1.4 -->

	<script src="./include/jQuery-2.1.4.min.js.下载"></script>

	<!-- Bootstrap 3.3.5 -->
	<!--<script src="/app_xgc/base/_libs/bootstrap/js/bootstrap.min.js"></script>-->
	<script src="./include/bootstrap.js.下载"></script>
	<script src="./include/coreplus-bootstrap.js.下载"></script>
	<script src="./include/xml2json.min.js.下载"></script>
	<script src="./include/layer.js.下载"></script>
	<!-- DataTables -->
	<script src="./include/jquery.dataTables.js.下载"></script>
	<script src="./include/jquery.tablebuttons.js.下载"></script>
	<script src="./include/dataTables.bootstrap.js.下载"></script>
	<!-- date-range-picker -->
	<script src="./include/moment-with-locales.js.下载"></script>
	<script src="./include/daterangepicker.js.下载"></script>
	<script src="./include/bootstrap-datepicker.js.下载"></script>
	<!-- InputMask -->
	<script src="./include/jquery.inputmask.js.下载"></script>
	<script src="./include/jquery.inputmask.date.extensions.js.下载"></script>
	<script src="./include/jquery.inputmask.extensions.js.下载"></script>
	<!-- bootstrap color picker -->
	<script src="./include/bootstrap-colorpicker.min.js.下载"></script>
	<!-- bootstrap time picker -->
	<script src="./include/bootstrap-timepicker.min.js.下载"></script>
	<!-- iCheck 1.0.1 -->
	<script src="./include/icheck.js.下载"></script>
	<!-- Select2 -->
	<script src="./include/select2.full.js.下载"></script>
	<!-- Slimscroll -->
	<script src="./include/jquery.slimscroll.min.js.下载"></script>
	<!-- FastClick -->
	<script src="./include/fastclick.min.js.下载"></script>

	<script src="./include/math.min.js.下载"></script>

	<!-- SDM App -->
	<script src="./include/app.js.下载"></script>
	<script src="./include/workflow.js.下载"></script>
	<script src="./include/workflow2.js.下载"></script>
	<script src="./include/entityManage.js.下载"></script>

	<script src="./include/adjustheight.js.下载"></script>
	<script src="./include/jquery.uploadify.min.js.下载" type="text/javascript"></script>
	<script src="./include/iPortalInit.js.下载"></script>
	<script src="./include/iportal-ex.js.下载"></script>
	<script src="./include/wangEditor.js.下载"></script>
	<!-- éæ ææºç«¯ -->
	<script src="./include/coreplus-form-mobile.js.下载"></script>
	<!-- sui -->
	<script src="./include/coreplus.js.下载"></script>
	<script src="./include/sui-ext.js.下载"></script>
	<script src="./include/sui-cascade.js.下载"></script>

	<script type="text/javascript">
		var id = "";
		var stuInfoIndex = {"stuname":"", "department":"", "stuid":"", "starttime":"", "endtime":""};
		
		// 读取图片
		$("#picture-input").on("change", function(event) {
			var fileList = event.target.files;
			var file;
			if (fileList && fileList.length > 0) {
				file = fileList[0];
			}

			var URL = window.URL || window.webkitURL; // window的URL工具
			var imgURL = URL.createObjectURL(file);	  // 通过file生成url
			document.getElementById("zpimg").src = imgURL;
			console.log(imgURL);
		});

		$(function () {
			$(".display-stu-info").hide();
			$("#upload-info-div").show();
			
			// 从cookie中读取并设置信息
			var formFirstChild = document.getElementsByClassName("upload-student-info")[0].firstElementChild;
			for (key in stuInfoIndex) {
				if (isExistedCookie(key)) {
					formFirstChild.getElementsByTagName("input")[0].setAttribute("value", getCookie(key));
				}
				formFirstChild = formFirstChild.nextElementSibling;
			}

			var obj = window.setInterval(function () {		// update time
				var sj = moment(new Date()).format('YYYY-MM-DD HH:mm:ss');
				$("[name=sj]").text(sj);
			}, 999);

		});

		function uploadStuInfo() {
			// 读取表单信息
			var form = document.getElementsByClassName("upload-student-info")[0];
			var formFirstChild = form.firstElementChild;
			var flag = true;
			for (key in stuInfoIndex) {
				var inputString = formFirstChild.getElementsByTagName("input")[0].value;
				stuInfoIndex[key] = inputString;
				// 空表单标记
				if (stuInfoIndex[key] == "" || stuInfoIndex[key] == null) {
					flag = false;
					//alert(key);
				} else {
					setCookie(key, stuInfoIndex[key], 1);
				}
				formFirstChild = formFirstChild.nextElementSibling;
			}
			
			if (flag) {		// 信息完整，进入页面
				$("#upload-info-div").hide();
				$(".display-stu-info").show();

				var stuInfoArray = new Array();
				var i = 0;
				for (key in stuInfoIndex) {
					var info = getCookie(key);
					if (key == "starttime" || key == "endtime") {
						info = info.replace("T", " ");
					}
					stuInfoArray[i++] = info;
				}
				setInformation(stuInfoArray[0], stuInfoArray[1], stuInfoArray[2], stuInfoArray[3], stuInfoArray[4]);
			} else {
				alert("请输入完整信息！");
			}
		}

		$("#cx_btn").on("click", function () {//出校隐藏进校按钮
			layer.open({
				icon: 7,
				content: "确认是否出校？",
				closeBtn: 0,
				title: '出校确认',
				shadeClose: false,
				btn: ['确认', '关闭'],
				btn1: function (index, layero) {
					var entity = {};
					var sk = new Date($.ajax({ async: false }).getResponseHeader("Date"));
					var ksnyr = sk.getFullYear() + '-' + ("0" + (sk.getMonth() + 1)).slice(-2) + "-" + ("0" + sk.getDate()).slice(-2) + " " + ("0" + sk.getHours()).slice(-2) + ":" + ("0" + sk.getMinutes()).slice(-2);
					setZt('hx');
					layer.close(index);
				},
				btn2: function (index, layero) {
					return;
				}
			});
		});

		$("#jx_btn").on("click", function () {//出校隐藏进校按钮
			layer.open({
				icon: 7,
				content: "确认是否进校？",
				closeBtn: 0,
				title: '进校确认',
				shadeClose: false,
				btn: ['确认', '关闭'],
				btn1: function (index, layero) {
					var entity = {};
					var sk = new Date($.ajax({ async: false }).getResponseHeader("Date"));
					var ksnyr = sk.getFullYear() + '-' + ("0" + (sk.getMonth() + 1)).slice(-2) + "-" + ("0" + sk.getDate()).slice(-2) + " " + ("0" + sk.getHours()).slice(-2) + ":" + ("0" + sk.getMinutes()).slice(-2);
					setZt('jz');
					layer.close(index);
				},
				btn2: function (index, layero) {
					return;
				}
			});
		});

		function setInformation(stuname, department, stuid, starttime, endtime) {
			$("[name=xm]").text(stuname);
			$("[name=xy]").text(department);
			$("[name=gh]").text(stuid);
			$("[name=qjkssj]").text(starttime);
			$("[name=qjjssj]").text(endtime);
			getServerDate($("[name=qjkssj]").text(), $("[name=qjjssj]").text(), "0");
		}


		function getServerDate(kssj, jssj, zt) {
			var sj = moment(new Date($.ajax({ async: false }).getResponseHeader("Date"))).format('YYYY-MM-DD HH:mm:ss');
			var dqsj = sj.replace(/-/g, "").replace(/:/g, "").replace(" ", "");//当前时间 
			if ("0" == zt) {//出校
				setZt("cx");
			} else if ("1" == zt) {//已经出了，则显示回校
				setZt("hx");
			} else if ("2" == zt) {//已经回了，则显示禁止
				setZt("jz");
			} else {
				setZt("jz");
			}
		}

		function setZt(flag) {
			if ("cx" == flag) {//可以出校
				$("#jx_btn,.undtitle,.undtext,#jzlogo").hide();
				$("#cx_btn,.title.starttime,.title.endtime").show();
				$('.wrapper').removeClass("red").addClass("green");
				$(".body .statues").css('background', '#4daa40');
			} else if ("hx" == flag) {//可以回校
				$("#cx_btn,.undtitle,.undtext,#jzlogo").hide();
				$("#jx_btn,.title.starttime,.title.endtime").show();
				$('.wrapper').removeClass("red").addClass("blue");
				$(".body .statues").css('background', '#e03636');
			} else if ("jz" == flag) {//禁止出校
				$("#cx_btn,#jx_btn,.title.starttime,.title.endtime").hide();
				$(".undtitle,.undtext,#jzlogo").show();
				$('.wrapper').removeClass("blue").addClass("red");
			}
		}

		function setZp(url) {
			var url = __contextPath + "/downloadfile/" + url + "?isCompress=true";
			$("#zpimg").attr('src', url);
			if (SUI.Util.browserPlantform() == 'pc') {
				$("#zpimg").css({ "width": "200px", "height": "200px", "border-radius": "25px" });
			} else {
				$("#zpimg").css("border-radius", "25px");
			}
		}

		function getCookie(cname) {
			var name = cname + "=";
			var decodedCookie = decodeURIComponent(document.cookie);
			var ca = decodedCookie.split(';');
			for (var i = 0; i < ca.length; i++) {
				var c = ca[i];
				while (c.charAt(0) == ' ') {
					c = c.substring(1);
				}
				if (c.indexOf(name) == 0) {
					return c.substring(name.length, c.length);
				}
			}
			return "";
		}

		function setCookie(cname, cvalue, exdays) {
			var d = new Date();
			d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
			var expires = "expires=" + d.toUTCString();
			document.cookie = cname + "=" + cvalue + ";" + expires /*+ ";path=/"*/;
		}

		function isExistedCookie(cname) {
			var c = getCookie(cname);
			return c != "" ? true : false;
		}

	</script>
</body>

</html>